<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pagamento Confirmado - Maria Fernanda</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: "Inter", sans-serif; }
        .gradient-bg {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 50%, #ff1744 100%);
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .success-checkmark {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: block;
            stroke-width: 2;
            stroke: #4ade80;
            stroke-miterlimit: 10;
            margin: 0 auto;
            box-shadow: inset 0px 0px 0px #4ade80;
            animation: fill 0.4s ease-in-out 0.4s forwards, scale 0.3s ease-in-out 0.9s both;
        }
        .success-checkmark circle {
            stroke-dasharray: 166;
            stroke-dashoffset: 166;
            stroke-width: 2;
            stroke-miterlimit: 10;
            stroke: #4ade80;
            fill: none;
            animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
        }
        .success-checkmark path {
            transform-origin: 50% 50%;
            stroke-dasharray: 48;
            stroke-dashoffset: 48;
            animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
        }
        @keyframes stroke {
            100% { stroke-dashoffset: 0; }
        }
        @keyframes scale {
            0%, 100% { transform: none; }
            50% { transform: scale3d(1.1, 1.1, 1); }
        }
        @keyframes fill {
            100% { box-shadow: inset 0px 0px 0px 30px #4ade80; }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl shadow-2xl max-w-lg w-full overflow-hidden">
        <!-- Header de Sucesso -->
        <div class="bg-gradient-to-r from-green-500 to-emerald-600 text-white p-8 text-center">
            <div class="success-checkmark">
                <svg width="80" height="80" viewBox="0 0 80 80">
                    <circle cx="40" cy="40" r="38" fill="none"/>
                    <path d="M20 40l12 12 28-28" fill="none"/>
                </svg>
            </div>
            <h1 class="text-3xl font-bold mt-4 mb-2">Pagamento Confirmado!</h1>
            <p class="text-green-100">Obrigado por assinar o conte√∫do da Maria Fernanda</p>
        </div>
        
        <!-- Conte√∫do Principal -->
        <div class="p-8">
            <!-- Detalhes do Pagamento -->
            <div class="bg-gray-50 rounded-xl p-6 mb-6">
                <h3 class="font-bold text-gray-800 mb-4 text-center">Detalhes da Compra</h3>
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                        <span class="text-gray-600">Produto:</span>
                        <span class="font-semibold">Acesso Vital√≠cio</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Valor:</span>
                        <span class="font-semibold text-green-600">R$ 19,90</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Status:</span>
                        <span class="font-semibold text-green-600">‚úì Pago</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">ID da Transa√ß√£o:</span>
                        <span class="font-mono text-xs text-gray-500" id="transactionId">-</span>
                    </div>
                </div>
            </div>
            
            <!-- Formul√°rio de Conte√∫dos -->
            <div class="mb-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">
                    üéÅ Receba seus conte√∫dos
                </h3>
                <p class="text-gray-600 text-center mb-6">
                    Preencha seus dados abaixo para receber o acesso ao conte√∫do exclusivo
                </p>
                
                <form id="deliveryForm" class="space-y-4">
                    <!-- Nome -->
                    <div>
                        <label for="nome" class="block text-sm font-medium text-gray-700 mb-2">
                            Nome Completo *
                        </label>
                        <input 
                            type="text" 
                            id="nome" 
                            name="nome"
                            required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all"
                            placeholder="Digite seu nome completo"
                        >
                    </div>
                    
                    <!-- Email -->
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700 mb-2">
                            Email *
                        </label>
                        <input 
                            type="email" 
                            id="email" 
                            name="email"
                            required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all"
                            placeholder="seu@email.com"
                        >
                    </div>
                    
                    <!-- Telefone -->
                    <div>
                        <label for="telefone" class="block text-sm font-medium text-gray-700 mb-2">
                            WhatsApp *
                        </label>
                        <input 
                            type="tel" 
                            id="telefone" 
                            name="telefone"
                            required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all"
                            placeholder="(11) 99999-9999"
                        >
                    </div>
                    
                    <!-- Bot√£o de Envio -->
                    <button 
                        type="submit"
                        class="w-full bg-gradient-to-r from-orange-500 to-pink-500 text-white font-bold py-4 px-6 rounded-lg hover:from-orange-600 hover:to-pink-600 transition-all transform hover:scale-105 pulse-animation"
                    >
                        üöÄ Receber Meus Conte√∫dos
                    </button>
                </form>
            </div>
            
            <!-- O que voc√™ receber√° -->
            <div class="bg-orange-50 rounded-xl p-6 mb-6">
                <h4 class="font-bold text-orange-800 mb-3 text-center">O que voc√™ receber√°:</h4>
                <ul class="space-y-2 text-sm text-orange-700">
                    <li class="flex items-center">
                        <span class="text-green-500 mr-2">‚úì</span>
                        Acesso completo ao conte√∫do exclusivo
                    </li>
                    <li class="flex items-center">
                        <span class="text-green-500 mr-2">‚úì</span>
                        Chat privado com Maria Fernanda
                    </li>
                    <li class="flex items-center">
                        <span class="text-green-500 mr-2">‚úì</span>
                        Novos conte√∫dos em primeira m√£o
                    </li>
                    <li class="flex items-center">
                        <span class="text-green-500 mr-2">‚úì</span>
                        Suporte priorit√°rio
                    </li>
                </ul>
            </div>
            
            <!-- Status de Envio -->
            <div id="deliveryStatus" class="hidden text-center">
                <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg">
                    <div class="flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                        </svg>
                        <span class="font-semibold">Dados enviados com sucesso!</span>
                    </div>
                    <p class="text-sm mt-1">Voc√™ receber√° os conte√∫dos em at√© 5 minutos</p>
                </div>
            </div>
            
            
            <!-- Indica√ß√£o WhatsApp -->
            <div class="mb-4 p-4 bg-green-50 border border-green-200 rounded-lg">
                <div class="flex items-center justify-center">
                    <div class="text-center">
                        <div class="text-2xl mb-2">üí¨</div>
                        <h4 class="font-bold text-green-800 mb-1">Precisa de ajuda?</h4>
                        <p class="text-sm text-green-700">
                            Ou para receber mais f√°cil, me chame no WhatsApp!
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Bot√µes de A√ß√£o -->
            <div class="flex space-x-3 mt-6">
                <button 
                    onclick="voltarParaSite()" 
                    class="flex-1 bg-gray-500 text-white py-3 px-4 rounded-lg hover:bg-gray-600 transition-colors"
                >
                    Voltar ao Site
                </button>
                <button 
                    onclick="abrirWhatsApp()" 
                    class="flex-1 bg-green-500 text-white py-3 px-4 rounded-lg hover:bg-green-600 transition-colors font-bold"
                >
                    üí¨ Falar no WhatsApp
                </button>
            </div>
        </div>
    </div>

    <!-- Facebook Pixel -->
    <script>
      !function(f,b,e,v,n,t,s)
      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
      n.callMethod.apply(n,arguments):n.queue.push(arguments)};
      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
      n.queue=[];t=b.createElement(e);t.async=!0;
      t.src=v;s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s)}(window, document,'script',
      'https://connect.facebook.net/en_US/fbevents.js');
      fbq('init', 'SEU_PIXEL_ID_AQUI'); // üî¥ SUBSTITUIR: Coloque seu Pixel ID aqui
      fbq('track', 'PageView');
    </script>
    <noscript>
      <img height="1" width="1" style="display:none"
           src="https://www.facebook.com/tr?id=SEU_PIXEL_ID_AQUI&ev=PageView&noscript=1" /> // üî¥ SUBSTITUIR: Coloque seu Pixel ID aqui
    </noscript>
    <!-- End Facebook Pixel -->

    <!-- Scripts -->
    <script src="js/database.js"></script>
    <script src="js/lead-tracking.js"></script>
    <script src="js/facebook-pixel.js"></script>
    
    <script>
        // Obter dados da URL
        const urlParams = new URLSearchParams(window.location.search);
        const transactionId = urlParams.get('id') || 'N/A';
        const valor = urlParams.get('valor') || '19,90';
        const status = urlParams.get('status') || 'paid';
        
        // Evento Facebook Pixel - Purchase
        if (typeof fbq !== 'undefined') {
          fbq('track', 'Purchase', {
            value: 19.90,
            currency: 'BRL',
            content_name: 'Curso Privacy',
            content_category: 'Digital Product',
            transaction_id: transactionId
          });
        }
        
        // Exibir ID da transa√ß√£o
        document.getElementById('transactionId').textContent = transactionId;
        
        // M√°scara para telefone
        document.getElementById('telefone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length >= 11) {
                value = value.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
            } else if (value.length >= 7) {
                value = value.replace(/(\d{2})(\d{4})(\d{0,4})/, '($1) $2-$3');
            } else if (value.length >= 3) {
                value = value.replace(/(\d{2})(\d{0,5})/, '($1) $2');
            }
            e.target.value = value;
        });
        
        // Envio do formul√°rio
        document.getElementById('deliveryForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            
            // Pegar dados da transa√ß√£o tempor√°ria (salva pelo pushinpay)
            const transacaoTemp = JSON.parse(localStorage.getItem('transacao_temp') || '{}');
            
            // Pegar dados de rastreamento de origem (LeadTracking)
            const trackingData = typeof LeadTracking !== 'undefined' 
                ? LeadTracking.getDadosRastreamento() 
                : JSON.parse(localStorage.getItem('lead_tracking') || '{}');
            
            // Combinar dados do formul√°rio com dados da transa√ß√£o e tracking
            const dados = {
                nome: formData.get('nome'),
                email: formData.get('email'),
                telefone: formData.get('telefone'),
                transactionId: transactionId || transacaoTemp.transactionId,
                valor: parseFloat((valor || transacaoTemp.valor || '19.90').replace(',', '.')),
                plano: transacaoTemp.plano || '1 m√™s',
                status: transacaoTemp.status || status || 'paid',
                origem: trackingData.origem || transacaoTemp.origem || 'site',
                source: trackingData.source || 'direct',
                medium: trackingData.medium || 'none',
                campaign: trackingData.campaign || 'organic',
                tags: ['convertido', 'pago', 'formulario_preenchido'],
                timestamp: new Date().toISOString()
            };
            
            console.log('üìß Enviando dados completos do cliente:', dados);
            
            // Simular envio (aqui voc√™ integraria com sua API)
            try {
                // Mostrar loading
                const button = this.querySelector('button[type="submit"]');
                const originalText = button.innerHTML;
                button.innerHTML = '‚è≥ Enviando...';
                button.disabled = true;
                
                // Simular delay de envio
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Salvar no banco de dados para remarketing com TODOS os dados
                if (typeof Database !== 'undefined') {
                    const clienteSalvo = Database.adicionarCliente(dados);
                    console.log('‚úÖ Cliente salvo no Database com todos os dados:', clienteSalvo);
                    
                    // Registrar convers√£o no LeadTracking
                    if (typeof LeadTracking !== 'undefined') {
                        LeadTracking.rastrearConversao('formulario_agradecimento_completo');
                        console.log('‚úÖ Convers√£o registrada no LeadTracking');
                    }
                    
                    // Limpar transa√ß√£o tempor√°ria
                    localStorage.removeItem('transacao_temp');
                } else {
                    // Fallback para localStorage
                    const entregaveis = JSON.parse(localStorage.getItem('entregaveis') || '[]');
                    entregaveis.push(dados);
                    localStorage.setItem('entregaveis', JSON.stringify(entregaveis));
                }
                
                // Enviar notifica√ß√£o para seu WhatsApp pessoal
                enviarNotificacaoWhatsApp(dados);
                
                // Enviar notifica√ß√£o REAL para seu WhatsApp
                enviarNotificacaoReal(dados);
                
                // Mostrar sucesso
                document.getElementById('deliveryForm').classList.add('hidden');
                document.getElementById('deliveryStatus').classList.remove('hidden');
                
                // Abrir conte√∫do no Drive (deeplink)
                const DRIVE_DEEPLINK = 'https://drive.google.com/SEU_LINK_AQUI'; // üîÅ Substitua pelo link do Drive
                
                // Abrir o Drive ap√≥s 1 segundo
                setTimeout(() => {
                    window.open(DRIVE_DEEPLINK, '_blank');
                }, 1000);
                
            } catch (error) {
                console.error('‚ùå Erro ao enviar dados:', error);
                alert('Erro ao enviar dados. Tente novamente.');
                
                // Restaurar bot√£o
                button.innerHTML = originalText;
                button.disabled = false;
            }
        });
        
        // Fun√ß√£o para voltar ao site
        function voltarParaSite() {
            window.location.href = 'index.html';
        }
        
        // Fun√ß√£o para enviar notifica√ß√£o para seu WhatsApp pessoal
        function enviarNotificacaoWhatsApp(dados) {
            const dataHora = new Date().toLocaleString('pt-BR');
            const mensagem = `üö® NOVA VENDA CONFIRMADA! üö®

üìÖ Data/Hora: ${dataHora}
üí∞ Valor: R$ ${dados.valor}
üÜî ID Transa√ß√£o: ${dados.transactionId}

üë§ DADOS DO CLIENTE:
‚Ä¢ Nome: ${dados.nome}
‚Ä¢ Email: ${dados.email}
‚Ä¢ WhatsApp: ${dados.telefone}

‚úÖ Status: Pago
üì¶ Produto: Acesso Vital√≠cio

‚ö†Ô∏è A√á√ÉO NECESS√ÅRIA: Enviar conte√∫dos para o cliente!`;

            // Abrir WhatsApp diretamente
            const whatsappUrl = `https://wa.me/5547997118690?text=${encodeURIComponent(mensagem)}`;
            window.open(whatsappUrl, '_blank');
        }
        
        // Fun√ß√£o para enviar notifica√ß√£o REAL para seu Telegram
        async function enviarNotificacaoReal(dados) {
            const dataHora = new Date().toLocaleString('pt-BR');
            const mensagem = `üö® NOVA VENDA CONFIRMADA! üö®

üìÖ Data/Hora: ${dataHora}
üí∞ Valor: R$ ${dados.valor}
üÜî ID Transa√ß√£o: ${dados.transactionId}

üë§ DADOS DO CLIENTE:
‚Ä¢ Nome: ${dados.nome}
‚Ä¢ Email: ${dados.email}
‚Ä¢ WhatsApp: ${dados.telefone}

‚úÖ Status: Pago
üì¶ Produto: Acesso Vital√≠cio

‚ö†Ô∏è A√á√ÉO NECESS√ÅRIA: Enviar conte√∫dos para o cliente!`;

            try {
                // Enviar via Telegram Bot
                await enviarViaTelegram(mensagem, dados);
            } catch (error) {
                console.log('‚ö†Ô∏è Telegram falhou, usando fallback');
                // Fallback: Email
                enviarEmailNotificacao(dados, mensagem);
            }
        }
        
        // Fun√ß√£o para enviar via Telegram Bot (GRATUITO)
        async function enviarViaTelegram(mensagem, dados) {
            // ‚ö†Ô∏è CONFIGURE: Substitua pelos seus tokens
            const BOT_TOKEN = 'SEU_BOT_TOKEN_AQUI';
            const CHAT_ID = 'SEU_CHAT_ID_AQUI';
            
            const telegramUrl = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`;
            
            const payload = {
                chat_id: CHAT_ID,
                text: mensagem,
                parse_mode: 'HTML'
            };
            
            const response = await fetch(telegramUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(payload)
            });
            
            if (response.ok) {
                console.log('‚úÖ Notifica√ß√£o enviada via Telegram');
                return true;
            } else {
                throw new Error('Telegram falhou');
            }
        }
        
        
        // Fun√ß√£o para enviar email de notifica√ß√£o (fallback)
        function enviarEmailNotificacao(dados, mensagem) {
            const assunto = `Nova Venda - ${dados.nome}`;
            const corpoEmail = `
Nova venda confirmada!

${mensagem}

Dados completos:
${JSON.stringify(dados, null, 2)}
            `;
            
            const emailUrl = `mailto:SEU_EMAIL@GMAIL.COM?subject=${encodeURIComponent(assunto)}&body=${encodeURIComponent(corpoEmail)}`; // üî¥ SUBSTITUIR: Coloque seu email aqui
            window.open(emailUrl, '_blank');
            
            console.log('üìß Email de notifica√ß√£o aberto');
        }
        
        
        
        
        
        
        
        
        // Fun√ß√£o para abrir WhatsApp
        function abrirWhatsApp() {
            const mensagem = `Ol√°! Acabei de fazer o pagamento e gostaria de receber meus conte√∫dos.\n\nID da Transa√ß√£o: ${transactionId}`;
            const whatsappUrl = `https://wa.me/5547997118690?text=${encodeURIComponent(mensagem)}`;
            window.open(whatsappUrl, '_blank');
        }
        
        // Anima√ß√£o de entrada
        document.addEventListener('DOMContentLoaded', function() {
            const card = document.querySelector('.bg-white');
            card.style.opacity = '0';
            card.style.transform = 'translateY(50px)';
            
            setTimeout(() => {
                card.style.transition = 'all 0.6s ease-out';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, 100);
        });
    </script>
</body>
</html>
